<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">

  <link rel="shortcut icon" href="/assets/images/logo.png " type="image/png">
  <link rel="icon" href="/assets/images/logo.png " type="image/png">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Setup Capybara in Rails | Hugo Chou 周昌权</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Setup Capybara in Rails" />
<meta name="author" content="Hugo Chou" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="今天在新的 Rails 项目中首次使用 Capybara 进行集成测试时，报了「undefined method `visit’ for …」的 NoMethodError 错误。查看了 Capybara 的 GitHub 主页，在 Setup 一节写着：" />
<meta property="og:description" content="今天在新的 Rails 项目中首次使用 Capybara 进行集成测试时，报了「undefined method `visit’ for …」的 NoMethodError 错误。查看了 Capybara 的 GitHub 主页，在 Setup 一节写着：" />
<link rel="canonical" href="https://hugochougt.com/blog/setup-capybara-in-rails" />
<meta property="og:url" content="https://hugochougt.com/blog/setup-capybara-in-rails" />
<meta property="og:site_name" content="Hugo Chou 周昌权" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-08-26T22:51:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Setup Capybara in Rails" />
<meta name="twitter:site" content="@hugochougt" />
<meta name="twitter:creator" content="@hugochougt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Hugo Chou","url":"https://hugochougt.com"},"dateModified":"2014-08-26T22:51:00+00:00","datePublished":"2014-08-26T22:51:00+00:00","description":"今天在新的 Rails 项目中首次使用 Capybara 进行集成测试时，报了「undefined method `visit’ for …」的 NoMethodError 错误。查看了 Capybara 的 GitHub 主页，在 Setup 一节写着：","headline":"Setup Capybara in Rails","mainEntityOfPage":{"@type":"WebPage","@id":"https://hugochougt.com/blog/setup-capybara-in-rails"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://hugochougt.com/assets/images/logo.png"},"name":"Hugo Chou"},"url":"https://hugochougt.com/blog/setup-capybara-in-rails"}</script>
<!-- End Jekyll SEO tag -->

</head>

  <body>
    <nav class="flex flex-wrap items-center justify-center px-2 py-6">
  <div class="container px-4 mx-auto flex flex-wrap items-center justify-center">
    <div class="flex md:block" id="navbar">
      <div class="flex mr-auto w-full">
        
        <a class="text-sm text-gray-500 hover:text-gray-900 px-3 py-2 lg:py-1 mx-auto uppercase"
          href="/">
          Home
        </a>
        
        <a class="text-sm text-gray-500 hover:text-gray-900 px-3 py-2 lg:py-1 mx-auto uppercase"
          href="/blog/">
          Blog
        </a>
        
      </div>
    </div>
  </div>
</nav>


<div class="flex flex-wrap items-center justify-center mx-auto px-4 pt-4 prose prose-stone">
  <h1 class="text-center mt-6 mb-6">Setup Capybara in Rails</h1>
  <article class="py-1">
    <p>今天在新的 Rails 项目中首次使用 Capybara 进行集成测试时，报了「undefined method `visit’ for …」的 NoMethodError 错误。查看了 Capybara 的 GitHub <a href="https://github.com/jnicklas/capybara">主页</a>，在 <em>Setup</em> 一节写着：</p>

<p>If the application that you are testing is a Rails app, add this line to your test helper file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>require 'capybara/rails'
</code></pre></div></div>

<p>但是我不知道上述的 <strong>test helper file</strong> 指的是 spec/ 目录下的 <code class="language-plaintext highlighter-rouge">rails_helper.rb</code> 还是 <code class="language-plaintext highlighter-rouge">spec_helper.rb</code>。阅读了 SO 上的这个<a href="http://stackoverflow.com/questions/15148585/undefined-method-visit-when-using-rspec-and-capybara-in-rails">帖子</a>排名第一的答案后，执行了下两步就可以使用 Capybara 的集成测试了：</p>

<ol>
  <li>在 rails_helper.rb 文件的 <code class="language-plaintext highlighter-rouge">require 'rspec/rails'</code> 代码下添加一行 <code class="language-plaintext highlighter-rouge">require 'capybara/rails'</code> 代码</li>
  <li>在 rails_helper.rb 文件的 <em>RSpec.configure</em> 代码块中添加一行 <code class="language-plaintext highlighter-rouge">config.include Capybara::DSL</code> 代码</li>
</ol>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># This file is copied to spec/ when you run 'rails generate rspec:install'</span>
<span class="no">ENV</span><span class="p">[</span><span class="s2">"RAILS_ENV"</span><span class="p">]</span> <span class="o">||=</span> <span class="s1">'test'</span>
<span class="nb">require</span> <span class="s1">'spec_helper'</span>
<span class="nb">require</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"../../config/environment"</span><span class="p">,</span> <span class="kp">__FILE__</span><span class="p">)</span>
<span class="nb">require</span> <span class="s1">'rspec/rails'</span>
<span class="nb">require</span> <span class="s1">'capybara/rails'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">include</span> <span class="no">Capybara</span><span class="o">::</span><span class="no">DSL</span>
<span class="k">end</span>
</code></pre></div></div>

<p>-EOF-</p>

  </article>
</div>

    <footer class="relative px-4 pt-4 pb-4">
  <div class="flex flex-wrap items-center justify-center">
    <div class="text-sm text-gray-300">
      &copy; 2023 Hugo Chou
    </div>
  </div>
</footer>

  </body>
</html>
