<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">

  <link rel="shortcut icon" href="/assets/images/logo.png " type="image/png">
  <link rel="icon" href="/assets/images/logo.png " type="image/png">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Difference between attr_accessor and attr_accessible | Hugo Chou 周昌权</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Difference between attr_accessor and attr_accessible" />
<meta name="author" content="Hugo Chou" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="某次 code review，CTO 指出某个 field 不能放到 attr_accessible 里，因为它是支持 mass-assigment 的，会导致安全问题。直到那个时候，我才留意到原来 attr_accessible 是不同于 attr_accessor 的。" />
<meta property="og:description" content="某次 code review，CTO 指出某个 field 不能放到 attr_accessible 里，因为它是支持 mass-assigment 的，会导致安全问题。直到那个时候，我才留意到原来 attr_accessible 是不同于 attr_accessor 的。" />
<link rel="canonical" href="https://hugochougt.com/blog/difference-between-ruby-s-attr-accessor-and-rails-attr-accessible" />
<meta property="og:url" content="https://hugochougt.com/blog/difference-between-ruby-s-attr-accessor-and-rails-attr-accessible" />
<meta property="og:site_name" content="Hugo Chou 周昌权" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-05-10T11:06:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Difference between attr_accessor and attr_accessible" />
<meta name="twitter:site" content="@hugochougt" />
<meta name="twitter:creator" content="@hugochougt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Hugo Chou","url":"https://hugochougt.com"},"dateModified":"2015-05-10T11:06:00+00:00","datePublished":"2015-05-10T11:06:00+00:00","description":"某次 code review，CTO 指出某个 field 不能放到 attr_accessible 里，因为它是支持 mass-assigment 的，会导致安全问题。直到那个时候，我才留意到原来 attr_accessible 是不同于 attr_accessor 的。","headline":"Difference between attr_accessor and attr_accessible","mainEntityOfPage":{"@type":"WebPage","@id":"https://hugochougt.com/blog/difference-between-ruby-s-attr-accessor-and-rails-attr-accessible"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://hugochougt.com/assets/images/logo.png"},"name":"Hugo Chou"},"url":"https://hugochougt.com/blog/difference-between-ruby-s-attr-accessor-and-rails-attr-accessible"}</script>
<!-- End Jekyll SEO tag -->

</head>

  <body>
    <nav class="flex flex-wrap items-center justify-center px-2 py-6">
  <div class="container px-4 mx-auto flex flex-wrap items-center justify-center">
    <div class="flex md:block" id="navbar">
      <div class="flex mr-auto w-full">
        
        <a class="text-sm text-gray-500 hover:text-gray-900 px-3 py-2 lg:py-1 mx-auto uppercase"
          href="/">
          Home
        </a>
        
        <a class="text-sm text-gray-500 hover:text-gray-900 px-3 py-2 lg:py-1 mx-auto uppercase"
          href="/blog/">
          Blog
        </a>
        
      </div>
    </div>
  </div>
</nav>


<div class="flex flex-wrap items-center justify-center mx-auto px-4 pt-4 prose prose-stone">
  <h1 class="text-center mt-6 mb-6">Difference between attr_accessor and attr_accessible</h1>
  <article class="py-1">
    <p>某次 code review，CTO 指出某个 field 不能放到 <code class="language-plaintext highlighter-rouge">attr_accessible</code> 里，因为它是支持 mass-assigment 的，会导致安全问题。直到那个时候，我才留意到原来 attr_accessible 是不同于 attr_accessor 的。</p>

<p><code class="language-plaintext highlighter-rouge">attr_accessible</code> 是 Rails 3 里才有的方法（Rails 1, 2 里我不知道有没有），Rails 4 之后去掉了该方法，使用 <a href="http://api.rubyonrails.org/classes/ActionController/StrongParameters.html">strong parameters</a>。</p>

<h2 id="rubys-attr_accessor">Ruby’s attr_accessor</h2>

<h3 id="方法签名">方法签名</h3>

<blockquote>
  <p>Module#attr_accessor(symbol, …) -&gt; nil</p>

  <p>Module#attr_accessor(string, …) -&gt; nil</p>

  <p>Defines a named attribute for this module, where the name is <em>symbol.id2name</em>, creating an instance variable (@name) and a corresponding access method to read it. Also creates a method called name= to set the attribute. String arguments are converted to symbols.</p>
</blockquote>

<p>简单翻译一下就是：<code class="language-plaintext highlighter-rouge">attr_accessor</code> 会创建实例变量及其对应的 getter/setter 方法。类似 attr_accessor 的方法叫做 <strong>Class Macro</strong>。在类似 Java 的静态语言中，当你定义了一个实例变量的时候，就需要为其写类似 getXXX() 和 setXXX() 的方法，虽然会有 Eclipse 帮你生成，但当有一大串的 getter/setter 方法在源码中的时候，还是会令人烦操的。Ruby 使用 Class Macro，很好地解决写一大段 getter/setter 方法的问题。</p>

<h3 id="代码示例">代码示例</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Article</span>
  <span class="nb">attr_accessor</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
<span class="k">end</span>

<span class="no">Article</span><span class="p">.</span><span class="nf">instance_methods</span><span class="p">(</span><span class="kp">false</span><span class="p">).</span><span class="nf">sort</span>
<span class="c1"># =&gt; [:body, :body=, :title, :title=]</span>

<span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
<span class="n">article</span><span class="p">.</span><span class="nf">instance_variables</span> <span class="c1"># =&gt; []</span>
<span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="o">=</span> <span class="s2">"Life is short, you need Ruby"</span>
<span class="n">article</span><span class="p">.</span><span class="nf">instance_variables</span> <span class="c1"># =&gt; [:@title]</span>

</code></pre></div></div>

<h2 id="rails-3s-attr_accessible">Rails 3’s attr_accessible</h2>

<h3 id="方法签名-1">方法签名</h3>

<blockquote>
  <p>attr_accessible(*args)</p>

  <p>Specifies a white list of model attributes that can be set via mass-assignment.</p>
</blockquote>

<p><a href="http://guides.rubyonrails.org/v3.2.13/security.html#mass-assignment">Mass-Assignment</a></p>

<p>Mass-assignment 来龙去脉的中文文章：<a href="http://blog.xdite.net/posts/2012/03/05/github-hacked-rails-security/">從 Github 被 hack，談 Rails 的安全性（ mass-assignment ）</a></p>

<h2 id="为什么我会把字段的-symbol-加到-attr_accessible-里">为什么我会把字段的 symbol 加到 attr_accessible 里？</h2>

<p>因为我最开始以为 Rails 的 attr_accessible 是 Ruby 的 attr_accessor，看到代码里的 attr_accessible 后面带了一串属性，我就以为那是为属性生成 getter/setter 的宏，然后想都没有想就把新的字段加到最后里。囧…</p>

<p><em>Rails 基本功还不扎实，是以为戒。</em></p>

<p>-EOF-</p>

  </article>
</div>

    <footer class="relative px-4 pt-4 pb-4">
  <div class="flex flex-wrap items-center justify-center">
    <div class="text-sm text-gray-300">
      &copy; 2023 Hugo Chou
    </div>
  </div>
</footer>

  </body>
</html>
